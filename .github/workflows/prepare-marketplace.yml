
name: Create Artifacts for Marketplace

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:

jobs:
  prepare-marketplace:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          ref: 'marketplace'

      - name: Download Artifacts from install repository
        run: |
          # Download artifacts from the install repository's master branch
          # Using raw.githubusercontent.com for direct file access
          INSTALL_BRANCH="master"
          echo "Downloading artifacts from scepman/install repository, branch: $INSTALL_BRANCH"
          
          # Download Artifacts.zip
          curl -L -o Artifacts.zip "https://raw.githubusercontent.com/scepman/install/$INSTALL_BRANCH/dist/Artifacts.zip"
          
          # Download CertMaster-Artifacts.zip
          curl -L -o CertMaster-Artifacts.zip "https://raw.githubusercontent.com/scepman/install/$INSTALL_BRANCH/dist-certmaster/CertMaster-Artifacts.zip"
          
          # Verify downloads
          echo "Downloaded files:"
          ls -lh Artifacts.zip CertMaster-Artifacts.zip

      - name: Assemble files to publish
        run: |
          mkdir publish
          cp mainTemplate.json publish
          cp createUiDefinition.json publish
          mkdir publish/dist
          cp Artifacts.zip publish/dist/
          mkdir publish/dist-certmaster
          cp CertMaster-Artifacts.zip publish/dist-certmaster/

      - name: Upload Artifacts
        uses: actions/upload-artifact@v5
        with:
          name: Release
          path: publish/*
          compression-level: 9